#!/bin/bash

#: Valid Args
JEKYLL="jekyll"
PLAYGROUND="playground"
COMPILE="compile"
CLEAN="clean"

#: Default params
DEFAULT_PLAYGROUND="BowPlayground"

#: terminal setup
bold=$(tput bold)
normal=$(tput sgr0)

red=$(tput setaf 1)
green=$(tput setaf 2)
lime=$(tput setaf 190)
reset=$(tput sgr0)

#: IN - Help

##
#   printHelp()
##
printHelp() {
    printHelpJekyll $@
    printHelpPlayground $@
    printHelpCompileClean $@
}

##
#   printHelpJekyll()
##
printHelpJekyll() {
    echo ""
    echo "${normal}$0 ${bold}$JEKYLL${normal} ${bold}--project ${normal}<project> ${bold}--output${normal} <output> [${bold}--main-page${normal} <main-page>]${reset}"
    echo ""
    echo "    ${green}${bold}--project${reset}${normal} source playgrounds to render documentation compatible with Jekyll"
    echo "    ${lime}${bold}--output${reset}${normal} path where to render the Jekyll site"
    echo "    ${lime}${bold}--main-page${reset}${normal} the main page in Jekyll file format [optional]${reset}"
    echo ""
}

##
#   printHelpPlayground()
##
printHelpPlayground() {
    echo ""
    echo "${normal}$0 ${bold}$PLAYGROUND${normal} [${bold}--name${normal} <project>] [${bold}--bow-version${normal} <number format: 0.0.0>] [${bold}--bow-branch${normal} <branch-name>] [${bold}--podfile${normal} <path>]"
    echo ""
    echo "    ${green}${bold}$PLAYGROUND${reset}${normal} build a playground compatible with external frameworks"
    echo "    ${lime}${bold}--name${reset}${normal} create a playground project using this name [default: $DEFAULT_PLAYGROUND]"
    echo "    ${lime}${bold}--bow-version${reset}${normal} bow's version to use [optional]"
    echo "    ${lime}${bold}--bow-branch${reset}${normal} bow's branch to use [optional]"
    echo "    ${lime}${bold}--podfile${reset}${normal} podfile to use in playground [optional]"
    echo ""
}

##
#   printHelpCompileClean()
##
printHelpCompile() {
    printHelpCompileClean
}

printHelpClean() {
    printHelpCompileClean
}

printHelpCompileClean() {
    echo ""
    echo "${normal}$0 ${bold}$COMPILE${normal} | ${bold}$CLEAN${normal} <project>"
    echo ""
    echo "    ${green}${bold}$COMPILE${reset}${normal} compile a Bow's playground"
    echo "    ${green}${bold}$CLEAN${reset}${normal} clean nef dependencies in Bow's playground"
    echo ""
}

#: - Jekyll

##
#   jekyll(List<String> args)
#   - Parameter `args`: list of command line arguments
##
jekyll() {
  projectPath=""
  outputPath=""
  mainPagePath=""

  while [ "$1" != "" ]; do
      case $1 in
          --project )      shift; projectPath=$1 ;;
          --output )       shift; outputPath=$1 ;;
          --main-page )    shift; mainPagePath=$1 ;;

          --name )         printHelpJekyll; exit 1 ;;
          --bow-version )  printHelpPlayground; exit 1 ;;
          --bow-branch )   printHelpPlayground; exit 1 ;;
          --podfile )      printHelpPlayground; exit 1 ;;

          $JEKYLL )        ;;
          $PLAYGROUND )    printHelpPlayground; exit 1 ;;
          $COMPILE )       printHelpCompile; exit 1 ;;
          $CLEAN )         printHelpClean; exit 1 ;;
          * )              printHelpJekyll; echo "${bold}[!] ${normal}${red}error:${reset} invalid argument: ${red}$1${reset}."; exit 1 ;;
      esac
      shift
  done

  if [ "$projectPath" == "" ] || [ "$outputPath" == "" ]; then
      printHelpJekyll; exit 1
  else
      ~/Documents/3.projects/47deg/nef/bin/nef-jekyll --project "$projectPath" --output "$outputPath" --main-page "$mainPagePath"
  fi
}

##
#   playground(List<String> args)
#   - Parameter `args`: list of command line arguments
##
playground() {
    projectName=$DEFAULT_PLAYGROUND
    version=""
    branch=""
    podfile=""

    while [ "$1" != "" ]; do
        case $1 in
            --project )      printHelpPlayground; exit 1 ;;
            --output )       printHelpPlayground; exit 1 ;;
            --main-page )    printHelpJekyll; exit 1 ;;

            --name )         shift; projectName=$1 ;;
            --bow-version )  shift; version=$1 ;;
            --bow-branch )   shift; branch=$1 ;;
            --podfile )      shift; podfile=$1 ;;

            $JEKYLL )        printHelpJekyll; exit 1 ;;
            $PLAYGROUND )    ;;
            $COMPILE )       printHelpCompile; exit 1 ;;
            $CLEAN )         printHelpClean; exit 1 ;;
            * )              printHelpPlayground $@; echo "${bold}[!] ${normal}${red}error:${reset} invalid argument: ${red}$1${reset}."; exit 1 ;;
        esac
        shift
    done

    if [ "${#version}" -gt 0 ]; then
      nef-playground --name "$projectName" --bow-version "$version"
    else
      nef-playground --name "$projectName" --bow-branch "$branch" --podfile "$podfile"
    fi

    nefc install  "$projectName"
}

#: - Compile

##
#   compile(List<String> args)
#   - Parameter `args`: list of command line arguments
##
compile() {
    projectFolder=""

    while [ "$1" != "" ]; do
        case $1 in
            --project )      printHelpJekyll; exit 1 ;;
            --output )       printHelpJekyll; exit 1 ;;
            --main-page )    printHelpJekyll; exit 1 ;;

            --name )         printHelpPlayground; exit 1 ;;
            --bow-version )  printHelpPlayground; exit 1 ;;
            --bow-branch )   printHelpPlayground; exit 1 ;;
            --podfile )      printHelpPlayground; exit 1 ;;

            $JEKYLL )        printHelpJekyll; exit 1 ;;
            $PLAYGROUND )    printHelpPlayground; exit 1 ;;
            $COMPILE )       shift; projectFolder=$1 ;;
            $CLEAN )         printHelpClean; exit 1 ;;
            * )              printHelpCompile; echo "${bold}[!] ${normal}${red}error:${reset} invalid argument: ${red}$1${reset}."; exit 1 ;;
        esac
        shift
    done

    if [ "${#projectFolder}" -gt 0 ]; then
      nefc compile "$projectFolder"
    else
      printHelpCompile; echo "${bold}[!] ${normal}${red}error:${reset} command format."; exit 1
    fi
}

#: - Clean

##
#   clean(List<String> args)
#   - Parameter `args`: list of command line arguments
##
clean() {
    projectFolder=""

    while [ "$1" != "" ]; do
        case $1 in
            --project )      printHelpJekyll; exit 1 ;;
            --output )       printHelpJekyll; exit 1 ;;
            --main-page )    printHelpJekyll; exit 1 ;;

            --name )         printHelpPlayground; exit 1 ;;
            --bow-version )  printHelpPlayground; exit 1 ;;
            --bow-branch )   printHelpPlayground; exit 1 ;;
            --podfile )      printHelpPlayground; exit 1 ;;

            $JEKYLL )        printHelpJekyll; exit 1 ;;
            $PLAYGROUND )    printHelpPlayground; exit 1 ;;
            $COMPILE )       printHelpCompile; exit 1 ;;
            $CLEAN )         shift; projectFolder=$1 ;;
            * )              printHelpClean; echo "${bold}[!] ${normal}${red}error:${reset} invalid argument: ${red}$1${reset}."; exit 1 ;;
        esac
        shift
    done

    if [ "${#projectFolder}" -gt 0 ]; then
      nefc clean "$projectFolder"
    else
      printHelpClean; echo "${bold}[!] ${normal}${red}error:${reset} command format."; exit 1
    fi
}

#: - MAIN
set -e

while [ "$1" != "" ]; do
    case $1 in
        $JEKYLL )     jekyll $@; exit 0 ;;
        $PLAYGROUND ) playground $@; exit 0 ;;
        $COMPILE )    compile $@; exit 0 ;;
        $CLEAN )      clean $@; exit 0 ;;
        -h | --help | help )  printHelp; exit 0 ;;
        * )                   printHelp; echo "${bold}[!] ${normal}${red}error:${reset} invalid argument: ${red}$1${reset}."; exit 1
    esac
    shift
done

printHelp; exit 1
